/*! behaviors.js is part of Webrecorder project. Copyright (C) 2021, Webrecorder Software. Licensed under the Affero General Public License v3. */(()=>{var t={278:(t,e,i)=>{"use strict";i.r(e),i.d(e,{AutoFetcher:()=>l});var s=i(968),o=i(669);const a=/\s*(\S*\s+[\d.]+[wx]),|(?:\s*,(?:\s+|(?=https?:)))/,n=/(url\s*\(\s*[\\"']*)([^)'"]+)([\\"']*\s*\))/gi,r=/(@import\s*[\\"']*)([^)'";]+)([\\"']*\s*;?)/gi;class l extends s.BackgroundBehavior{constructor(t=!1){super(),this.urlSet=new Set,this.urlqueue=[],this.numPending=0,this.numDone=0,this._donePromise=new Promise((t=>this._markDone=t)),t&&this.start()}get numFetching(){return this.numDone+this.numPending+this.urlqueue.length}async start(){await(0,o.awaitLoad)(),this.run(),this.initObserver(),await(0,o.sleep)(500),this.urlqueue.length||this.numPending||this._markDone()}done(){return this._donePromise}async run(){this.extractSrcSrcSetAll(document),this.extractStyleSheets()}isValidUrl(t){return t&&(t.startsWith("http:")||t.startsWith("https:"))}queueUrl(t){try{t=new URL(t,document.baseURI).href}catch(t){return!1}return!!this.isValidUrl(t)&&(!this.urlSet.has(t)&&(this.urlSet.add(t),this.doFetch(t),!0))}async doFetchStream(t){try{const e=await fetch(t,{credentials:"include",referrerPolicy:"origin-when-cross-origin"});this.debug(`Autofetch: started ${t}`);const i=e.body.getReader();let s=null;for(;(s=await i.read())&&!s.done;);return this.debug(`Autofetch: finished ${t}`),!0}catch(t){return this.debug(t),!1}}async doFetchNonCors(t){try{const e=new AbortController;await fetch(t,{mode:"no-cors",credentials:"include",referrerPolicy:"origin-when-cross-origin",abort:e}),e.abort(),this.debug(`Autofetch: started non-cors stream for ${t}`)}catch(e){this.debug(`Autofetch: failed non-cors for ${t}`)}}async doFetch(t){if(this.urlqueue.push(t),this.numPending<=6){for(;this.urlqueue.length>0;){const t=this.urlqueue.shift();this.numPending++,!1||await this.doFetchNonCors(t),this.numPending--,this.numDone++}this.numPending||this._markDone()}}initObserver(){this.mutobz=new MutationObserver((t=>this.observeChange(t))),this.mutobz.observe(document.documentElement,{characterData:!1,characterDataOldValue:!1,attributes:!0,attributeOldValue:!0,subtree:!0,childList:!0,attributeFilter:["srcset","loading"]})}processChangedNode(t){switch(t.nodeType){case Node.ATTRIBUTE_NODE:if("srcset"===t.nodeName&&this.extractSrcSetAttr(t.nodeValue),"loading"===t.nodeName&&"lazy"===t.nodeValue){const e=t.parentNode;"IMG"===e.tagName&&e.setAttribute("loading","eager")}break;case Node.TEXT_NODE:t.parentNode&&"STYLE"===t.parentNode.tagName&&this.extractStyleText(t.nodeValue);break;case Node.ELEMENT_NODE:t.sheet&&this.extractStyleSheet(t.sheet),this.extractSrcSrcSet(t),setTimeout((()=>this.extractSrcSrcSetAll(t)),1e3)}}observeChange(t){for(const e of t)if(this.processChangedNode(e.target),"childList"===e.type)for(const t of e.addedNodes)this.processChangedNode(t)}extractSrcSrcSetAll(t){const e=t.querySelectorAll("img[srcset], img[data-srcset], img[data-src], noscript > img[src], img[loading='lazy'], video[srcset], video[data-srcset], video[data-src], audio[srcset], audio[data-srcset], audio[data-src], picture > source[srcset], picture > source[data-srcset], picture > source[data-src], video > source[srcset], video > source[data-srcset], video > source[data-src], audio > source[srcset], audio > source[data-srcset], audio > source[data-src]");for(const t of e)this.extractSrcSrcSet(t)}extractSrcSrcSet(t){if(!t||t.nodeType!==Node.ELEMENT_NODE)return void console.warn("No elem to extract from");const e=t.getAttribute("data-src");e&&this.queueUrl(e),"lazy"===t.getAttribute("loading")&&t.setAttribute("loading","eager");const i=t.getAttribute("srcset");i&&this.extractSrcSetAttr(i);const s=t.getAttribute("data-srcset");s&&this.extractSrcSetAttr(s);const o=t.getAttribute("src");o&&"NOSCRIPT"===t.parentElement.tagName&&this.queueUrl(o)}extractSrcSetAttr(t){for(const e of t.split(a))if(e){const t=e.trim().split(" ");this.queueUrl(t[0])}}extractStyleSheets(t){t=t||document;for(const e of t.styleSheets)this.extractStyleSheet(e)}extractStyleSheet(t){let e;try{e=t.cssRules||t.rules}catch(t){return void this.debug("Can't access stylesheet")}for(const t of e)t.type===CSSRule.MEDIA_RULE&&this.extractStyleText(t.cssText)}extractStyleText(t){const e=(t,e,i,s)=>(this.queueUrl(i),e+i+s);t.replace(n,e).replace(r,e)}}},940:(t,e,i)=>{"use strict";i.r(e),i.d(e,{Autoplay:()=>a});var s=i(968),o=i(669);class a extends s.BackgroundBehavior{constructor(t){super(),this.mediaSet=new Set,this.autofetcher=t,this.numPlaying=0,this.promises=[],this.promises.push(new Promise((t=>this._initDone=t))),this.start()}async start(){await(0,o.awaitLoad)(),this.pollAudioVideo(),this._initDone()}async pollAudioVideo(){for(;;){for(const[,t]of document.querySelectorAll("video, audio, picture").entries())t.__bx_autoplay_found||(await this.loadMedia(t),t.__bx_autoplay_found=!0);await(0,o.sleep)(500)}}fetchSrcUrl(t){const e=t.src||t.currentSrc;return!!e&&(!(!e.startsWith("http:")&&!e.startsWith("https:"))&&(this.mediaSet.has(e)||(this.debug("fetch media source URL: "+e),this.mediaSet.add(e),this.autofetcher.queueUrl(e)),!0))}processFetchableUrl(t){let e=this.fetchSrcUrl(t);const i=t.querySelectorAll("source");for(const t of i){const i=this.fetchSrcUrl(t);e=e||i}return e}async loadMedia(t){this.debug("processing media element: "+t.outerHTML);const e=this.processFetchableUrl(t);t.play?e?t.paused||(t.pause(),this.debug("media URL found, pausing playback")):t.paused?(this.debug("no src url found, attempting to click or play: "+t.outerHTML),this.attemptMediaPlay(t).then((async e=>{let i=!0;for(e.then((()=>i=!1));i;)this.processFetchableUrl(t)&&(i=!1),this.debug("Waiting for fixed URL or media to finish: "+t.outerHTML),await(0,o.sleep)(1e3)}))):t.currentSrc&&this.debug("media playing from non-URL source: "+t.currentSrc):this.debug("media not playable, skipping")}async attemptMediaPlay(t){let e;const i=new Promise((t=>{e=t}));let s;this.promises.push(i);const a=new Promise((t=>{s=t}));let n=!1;t.addEventListener("loadstart",(()=>{n=!0,this.debug("loadstart"),s(!0)})),t.addEventListener("playing",(()=>{n=!0,this.debug("playing"),s(!0)})),t.addEventListener("loadeddata",(()=>this.debug("loadeddata"))),t.addEventListener("ended",(()=>{this.debug("ended"),e()})),t.addEventListener("pause",(()=>{this.debug("pause"),e()})),t.addEventListener("abort",(()=>{this.debug("abort"),e()})),t.addEventListener("error",(()=>{this.debug("error"),e()})),t.addEventListener("stalled",(()=>{this.debug("stalled"),e()})),t.addEventListener("suspend",(()=>{this.debug("suspend"),e()})),t.muted=!0;if(t.closest("a")||(t.click(),await(0,o.sleep)(500),!n))return t.play(),await a,i}done(){return Promise.allSettled(this.promises)}}},884:(t,e,i)=>{"use strict";i.r(e),i.d(e,{AutoScroll:()=>a});var s=i(968),o=i(669);class a extends s.Behavior{constructor(t){super(),this.autofetcher=t,this.showMoreQuery="//*[contains(text(), 'show more') or contains(text(), 'Show more')]",this.state={segments:1}}static get name(){return"Autoscroll"}canScrollMore(){return Math.round(self.scrollY+self.innerHeight)<Math.max(self.document.body.scrollHeight,self.document.body.offsetHeight,self.document.scrollingElement.clientHeight,self.document.scrollingElement.scrollHeight,self.document.scrollingElement.offsetHeight)}hasScrollEL(t){try{return!!self.getEventListeners(t).scroll}catch(t){return this.debug("getEventListeners() not available"),!0}}async shouldScroll(){if(!this.hasScrollEL(self.window)&&!this.hasScrollEL(self.document)&&!this.hasScrollEL(self.document.body))return!1;const t=self.document.scrollingElement.scrollHeight,e=this.autofetcher.numFetching,i=.98*document.scrollingElement.scrollHeight-self.innerHeight;return window.scrollTo({top:i,left:0,behavior:"auto"}),await(0,o.sleep)(500),(t!==self.document.scrollingElement.scrollHeight||e<this.autofetcher.numFetching)&&(window.scrollTo({top:0,left:0,behavior:"auto"}),!0)}shouldScrollUp(){return 0!==self.window.scrollY&&!((self.window.scrollY+self.scrollHeight)/self.document.scrollingElement.scrollHeight<.9)}async*[Symbol.asyncIterator](){this.shouldScrollUp()?yield*this.scrollUp():await this.shouldScroll()?yield*this.scrollDown():yield this.getState("Skipping autoscroll, page seems to not be responsive to scrolling events")}async*scrollDown(){let t=0,e=null;const i={top:Math.min(.1*self.document.scrollingElement.clientHeight,30),left:0,behavior:"auto"};let s=self.document.scrollingElement.scrollHeight;for(;this.canScrollMore();){const a=self.document.scrollingElement.scrollHeight;if(a>s&&(this.state.segments++,s=a),e||(e=(0,o.xpathNode)(this.showMoreQuery)),e&&(0,o.isInViewport)(e)&&(yield this.getState("Clicking 'Show More', awaiting more content"),e.click(),await(0,o.sleep)(o.waitUnit),await Promise.race([(0,o.waitUntil)((()=>self.document.scrollingElement.scrollHeight>a),500),(0,o.sleep)(3e4)]),e=null),self.scrollBy(i),await(0,o.sleep)(75),1===this.state.segments)yield this.getState(`Scrolling down by ${i.top} pixels every 0.075 seconds`),t=2;else{const e=t/(this.state.segments-1);this.debug(`Waiting upto ${e} seconds for more scroll segments`);const i=Date.now();await Promise.race([(0,o.waitUntil)((()=>this.canScrollMore()),75),(0,o.sleep)(e)]),t+=2*(Date.now()-i)}}}async*scrollUp(){const t={top:-Math.min(.1*self.document.scrollingElement.clientHeight,30),left:0,behavior:"auto"};let e=self.document.scrollingElement.scrollHeight;for(;self.scrollY>0;){const i=self.document.scrollingElement.scrollHeight;i>e&&(this.state.segments++,e=i),self.scrollBy(t),await(0,o.sleep)(75),1===this.state.segments?yield this.getState(`Scrolling up by ${t.top} pixels every 0.075 seconds`):await Promise.race([(0,o.waitUntil)((()=>self.scrollY>0),75),(0,o.sleep)(2e3*(this.state.segments-1))])}}}},138:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BehaviorManager:()=>l});var s=i(278),o=i(940),a=i(884),n=i(669),r=i(988);class l{constructor(){this.behaviors=[],this.loadedBehaviors=r.default.reduce(((t,e)=>(t[e.name]=e,t)),{}),this.mainBehavior=null,this.inited=!1,this.started=!1,(0,n.behaviorLog)("Loaded behaviors for: "+self.location.href)}init(t={autofetch:!0,autoplay:!0,autoscroll:!0,siteSpecific:!0}){if(this.inited)return;if(this.inited=!0,!self.window)return;if(this.timeout=t.timeout,void 0!==t.log){let e=t.log;"string"==typeof e&&(e=self[e]),"function"==typeof e?(0,n._setLogFunc)(e):!1===e&&(0,n._setLogFunc)(null)}this.autofetch=new s.AutoFetcher(!!t.autofetch),t.autofetch&&((0,n.behaviorLog)("Enable AutoFetcher"),this.behaviors.push(this.autofetch)),t.autoplay&&((0,n.behaviorLog)("Enable Autoplay"),this.behaviors.push(new o.Autoplay(this.autofetch)));let e=!1;if(self.window.top===self.window){if(t.siteSpecific)for(const i in this.loadedBehaviors){const s=this.loadedBehaviors[i];if(s.isMatch()){(0,n.behaviorLog)("Starting Site-Specific Behavior: "+i),this.mainBehaviorClass=s;const o="object"==typeof t.siteSpecific&&t.siteSpecific[i]||{};this.mainBehavior=new s(o),e=!0;break}}return!e&&t.autoscroll&&((0,n.behaviorLog)("Starting Autoscroll"),this.mainBehaviorClass=a.AutoScroll,this.mainBehavior=new a.AutoScroll(this.autofetch)),this.mainBehavior?(this.behaviors.push(this.mainBehavior),this.mainBehavior.name):""}}load(t){this.loadedBehaviors[t.name]=t}async resolve(t){const e=await i(75)(`${t}`);if(Array.isArray(e))for(const t of e)this.load(t);else this.load(e)}async run(t){if(this.started)return void this.unpause();this.init(t),await(0,n.awaitLoad)(),this.mainBehavior&&this.mainBehavior.start(),this.started=!0;let e=Promise.allSettled(this.behaviors.map((t=>t.done())));this.timeout?((0,n.behaviorLog)(`Waiting for behaviors to finish or ${this.timeout}ms timeout`),e=Promise.race([e,(0,n.sleep)(this.timeout)])):(0,n.behaviorLog)("Waiting for behaviors to finish"),await e,(0,n.behaviorLog)("All Behaviors Done for "+self.location.href),this.mainBehavior&&this.mainBehaviorClass.cleanup&&this.mainBehavior.cleanup()}async runOne(t,e={}){const i=r.default.find((e=>e.name===t));if(void 0===i)return void console.error(`No behavior of name ${t} found`);const s=new i(e);s.start(),console.log(`Running behavior: ${t}`),await s.done(),console.log(`Behavior ${t} completed`)}pause(){(0,n.behaviorLog)("Pausing Main Behavior"+this.mainBehaviorClass.name),this.mainBehavior&&this.mainBehavior.pause()}unpause(){this.mainBehavior&&this.mainBehavior.unpause()}doAsyncFetch(t){return(0,n.behaviorLog)("Queueing Async Fetch Url: "+t),this.autofetch.queueUrl(t)}}(0,n._setBehaviorManager)(l),(0,n.installBehaviors)(self)},968:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BackgroundBehavior:()=>o,Behavior:()=>a});var s=i(669);class o{debug(t){(0,s.behaviorLog)(t,"debug")}log(t){(0,s.behaviorLog)(t,"info")}}class a extends o{constructor(){super(),this._running=null,this.paused=null,this._unpause=null,this.state={},this.scrollOpts={behavior:"smooth",block:"center",inline:"center"}}start(){this._running=this.run()}done(){return this._running?this._running:Promise.resolve()}async run(){try{for await(const t of this)this.log(t),this.paused&&await this.paused;this.log(this.getState("done!"))}catch(t){this.log(this.getState(t))}}pause(){this.paused||(this.paused=new Promise((t=>{this._unpause=t})))}unpause(){this._unpause&&(this._unpause(),this.paused=null,this._unpause=null)}getState(t,e){return e&&(void 0===this.state[e]?this.state[e]=1:this.state[e]++),{state:this.state,msg:t}}cleanup(){}setOpts(t){this.opts=t}getOpt(t){return this.opts?this.opts[t]:null}static load(){self.__bx_behaviors?self.__bx_behaviors.load(this):console.warn(`Could not load ${this.name} behavior: window.__bx_behaviors is not initialized`)}}},669:(t,e,i)=>{"use strict";i.r(e),i.d(e,{scrollAndClick:()=>n,waitUnit:()=>r,sleep:()=>l,waitUntil:()=>h,waitUntilNode:()=>c,awaitLoad:()=>d,behaviorLog:()=>w,openWindow:()=>p,_setLogFunc:()=>m,_setBehaviorManager:()=>f,installBehaviors:()=>g,RestoreState:()=>v,HistoryState:()=>y,xpathNode:()=>b,xpathNodes:()=>S,xpathString:()=>x,iterChildElem:()=>N,iterChildMatches:()=>P,isInViewport:()=>U,scrollToOffset:()=>E});let s=console.log,o=null;const a={behavior:"smooth",block:"center",inline:"center"};async function n(t,e=500,i=a){t.scrollIntoView(i),await l(e),t.click()}const r=200;function l(t){return new Promise((e=>setTimeout(e,t)))}async function h(t,e=r){for(;!t();)await l(e)}async function c(t,e=document,i=null,s=1e3,o=r){let a=null,n=!1;const l=h((()=>(a=b(t,e),n||a!==i&&null!==a)),o),c=new Promise((t=>setTimeout((()=>{n=!0,t("TIMEOUT")}),s)));return await Promise.race([l,c]),a}function d(){return new Promise((t=>{"complete"===document.readyState?t():window.addEventListener("load",t)}))}function u(t,e){try{t(e)}catch(i){t(JSON.stringify(e))}}function w(t,e="debug"){s&&u(s,{data:t,type:e})}async function p(t){if(self.__bx_open){const e=new Promise((t=>self.__bx_openResolve=t));u(self.__bx_open,{url:t});let i=null;try{if(i=await e,i)return i}catch(t){console.warn(t)}finally{delete self.__bx_openResolve}}return window.open(t)}function m(t){s=t}function f(t){o=t}function g(t){t.__bx_behaviors=new o}class v{constructor(t,e){this.matchValue=x(t,e)}async restore(t,e){let i=null;for(;i=b(t),!i;)await l(100);return b(e.replace("$1",this.matchValue),i)}}class y{constructor(t){this.loc=window.location.href,t()}get changed(){return window.location.href!==this.loc}goBack(t){if(!this.changed)return Promise.resolve(!0);const e=b(t);return new Promise((t=>{window.addEventListener("popstate",(()=>{t()}),{once:!0}),e?e.click():window.history.back()}))}}function b(t,e){return e=e||document,document.evaluate(t,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE).singleNodeValue}function*S(t,e){e=e||document;let i=document.evaluate(t,e,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE),s=null;for(;null!==(s=i.iterateNext());)yield s}function x(t,e){return e=e||document,document.evaluate(t,e,null,XPathResult.STRING_TYPE).stringValue}async function*N(t,e,i){let s=t.firstElementChild;for(;s;)yield s,s.nextElementSibling||await Promise.race([h((()=>!!s.nextElementSibling),e),l(i)]),s=s.nextElementSibling}async function*P(t,e,i=r,s=5e3){let o=b(`.//${t}`,e);const a=e=>b(`./following-sibling::${t}`,e);for(;o;){yield o;let t=a(o);t?o=t:(await Promise.race([h((()=>(t=a(o),t)),i),l(s)]),o=t)}}function U(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}function E(t,e=0){const i=t.getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:i,behavior:"smooth"})}},274:(t,e,i)=>{"use strict";i.r(e),i.d(e,{FacebookTimelineBehavior:()=>a});var s=i(968),o=i(669);class a extends s.Behavior{static isMatch(){return window.location.href.match(/https:\/\/(www\.)?facebook\.com\//)}static get name(){return"Facebook"}constructor(){super(),this.feedQuery="//div[@role='feed']",this.articleQuery=".//div[@role='article']",this.pageletPostList="//div[@data-pagelet='page']/div[@role='main']//div[@role='main']/div",this.pageletProfilePostList="//div[@data-pagelet='page']//div[@data-pagelet='ProfileTimeline']",this.articleToPostList="//div[@role='article']/../../../../div",this.photosOrVideosQuery=`.//a[(contains(@href, '/photos/') or contains(@href, '/photo/?') or contains(@href, '/videos/')) and (starts-with(@href, '${window.location.origin}/') or starts-with(@href, '/'))]`,this.postQuery=".//a[contains(@href, '/posts/')]",this.extraLabel="//*[starts-with(text(), '+')]",this.nextSlideQuery="//div[@data-name='media-viewer-nav-container']/div[@data-visualcompletion][2]//div[@role='button']",this.closeButtonQuery="//div[@aria-hidden='false']//div[@role='button' and not(@aria-hidden) and @aria-label]",this.commentListQuery=".//ul[(../h3) or (../h4)]",this.commentMoreReplies="./div[2]/div[1]/div[2]/div[@role='button']",this.commentMoreComments="./following-sibling::div/div/div[2][@role='button'][./span/span]",this.viewCommentsQuery=".//h4/..//div[@role='button']",this.photoCommentListQuery="//ul[../h2]",this.firstPhotoThumbnail="//div[@role='main']//div[3]//div[contains(@style, 'border-radius')]//div[contains(@style, 'max-width') and contains(@style, 'min-width')]//a[@role='link']",this.firstVideoThumbnail="//div[@role='main']//div[contains(@style, 'z-index')]/following-sibling::div/div/div/div[last()]//a[contains(@href, '/videos/') and @aria-hidden!='true']",this.firstVideoSimple="//div[@role='main']//a[contains(@href, '/videos/') and @aria-hidden!='true']",this.mainVideoQuery="//div[@data-pagelet='root']//div[@role='dialog']//div[@role='main']//video",this.nextVideo="following::a[contains(@href, '/videos/') and @aria-hidden!='true']",this.isPhotoVideoPage=/^.*facebook\.com\/[^/]+\/(photos|videos)\/.+/,this.isPhotosPage=/^.*facebook\.com\/[^/]+\/photos\/?($|\?)/,this.isVideosPage=/^.*facebook\.com\/[^/]+\/videos\/?($|\?)/,this.extraWindow=null,this.allowNewWindow=!1,this.state={}}async*[Symbol.asyncIterator](){if(yield this.getState("Starting..."),await(0,o.sleep)(2e3),this.isPhotosPage.exec(window.location.href))return this.state={photos:0,comments:0},void(yield*this.iterPhotoSlideShow());if(this.isVideosPage.exec(window.location.href))return this.state={videos:0,comments:0},void(yield*this.iterAllVideos());if(this.isPhotoVideoPage.exec(window.location.href)){this.state={comments:0};const t=(0,o.xpathNode)(this.photoCommentListQuery);yield*this.iterComments(t,1e3)}else this.state={posts:0,comments:0,videos:0},yield*this.iterPostFeeds()}async*iterPostFeeds(){const t=Array.from((0,o.xpathNodes)(this.feedQuery));if(t&&t.length)for(const e of t)for await(const t of(0,o.iterChildElem)(e,o.waitUnit,10*o.waitUntil))yield*this.viewPost((0,o.xpathNode)(this.articleQuery,t));else{const t=(0,o.xpathNode)(this.pageletPostList)||(0,o.xpathNode)(this.pageletProfilePostList)||(0,o.xpathNode)(this.articleToPostList);if(!t)return;for await(const e of(0,o.iterChildElem)(t,o.waitUnit,10*o.waitUntil))yield*this.viewPost((0,o.xpathNode)(this.articleQuery,e))}this.extraWindow&&this.extraWindow.close()}async*viewPost(t,e=2){if(!t)return;const i=(0,o.xpathNode)(this.postQuery,t);let s="";i&&(s=new URL(i.href,window.location.href),s.search=""),yield this.getState("Viewing post "+s,"posts"),t.scrollIntoView(this.scrollOpts),await(0,o.sleep)(2*o.waitUnit),(0,o.xpathNode)(".//video",t)&&(yield this.getState("Playing inline video","videos"),await(0,o.sleep)(2*o.waitUnit));let a=(0,o.xpathNode)(this.commentListQuery,t);if(!a){const e=(0,o.xpathNode)(this.viewCommentsQuery,t);e&&(e.click(),await(0,o.sleep)(2*o.waitUnit)),a=(0,o.xpathNode)(this.commentListQuery,t)}yield*this.iterComments(a,e),await(0,o.sleep)(5*o.waitUnit)}async*viewPhotosOrVideos(t){const e=Array.from((0,o.xpathNodes)(this.photosOrVideosQuery,t)),i=new Set;let s=0;for(const t of e){const a=new URL(t.href,window.location.href);if(-1===t.href.indexOf("?fbid")&&(a.search=""),i.has(a.href))continue;const n=t.href.indexOf("/video")>=0?"videos":"photos";++s,i.add(a.href),yield this.getState(`Viewing ${n} ${a.href}`,n),t.scrollIntoView(),await(0,o.sleep)(5*o.waitUnit),t.click(),await(0,o.sleep)(10*o.waitUnit),this.allowNewWindow&&await this.openNewWindow(a.href),s===e.length&&(yield*this.viewExtraObjects(t,n,this.allowNewWindow));const r=(0,o.xpathNode)(this.closeButtonQuery);r&&(r.click(),await(0,o.sleep)(2*o.waitUnit))}}async*viewExtraObjects(t,e,i){const s=(0,o.xpathNode)(this.extraLabel,t);if(!s)return;const a=Number(s.innerText.slice(1));if(isNaN(a))return;let n;for(let t=0;t<a;t++){const t=(0,o.xpathNode)(this.nextSlideQuery);t&&(n=window.location.href,t.click(),await(0,o.sleep)(5*o.waitUnit),await(0,o.waitUntil)((()=>window.location.href!==n),2*o.waitUnit),yield this.getState(`Viewing extra ${e} ${window.location.href}`),i&&await this.openNewWindow(window.location.href))}}async openNewWindow(t){this.extraWindow?this.extraWindow.location.href=t:this.extraWindow=await(0,o.openWindow)(t)}async*iterComments(t,e=2){if(!t)return void await(0,o.sleep)(5*o.waitUnit);let i=t.firstElementChild,s=null,a=0;for(;i&&a<e;){for(;i&&a<e;){yield this.getState("Loading comments","comments"),i.scrollIntoView(this.scrollOpts),await(0,o.sleep)(2*o.waitUnit);const t=(0,o.xpathNode)(this.commentMoreReplies,i);t&&(t.click(),await(0,o.sleep)(5*o.waitUnit)),s=i,i=s.nextElementSibling,a++}if(a===e)break;let n=(0,o.xpathNode)(this.commentMoreComments,t);n&&(n.scrollIntoView(this.scrollOpts),n.click(),await(0,o.sleep)(5*o.waitUnit),s&&(i=s.nextElementSibling,await(0,o.sleep)(5*o.waitUnit)))}await(0,o.sleep)(2*o.waitUnit)}async*iterPhotoSlideShow(){const t=(0,o.xpathNode)(this.firstPhotoThumbnail);if(!t)return;let e=window.location.href;t.scrollIntoView(this.scrollOpts),t.click(),await(0,o.sleep)(5*o.waitUnit),await(0,o.waitUntil)((()=>window.location.href!==e),2*o.waitUnit);let i=null;for(;(i=(0,o.xpathNode)(this.nextSlideQuery))&&(e=window.location.href,await(0,o.sleep)(o.waitUnit),i.click(),await(0,o.sleep)(5*o.waitUnit),await Promise.race([(0,o.waitUntil)((()=>window.location.href!==e),2*o.waitUnit),(0,o.sleep)(3e3)]),window.location.href!==e);){yield this.getState(`Viewing photo ${window.location.href}`,"photos");const t=(0,o.xpathNode)(this.photoCommentListQuery);yield*this.iterComments(t,2),await(0,o.sleep)(5*o.waitUnit)}}async*iterAllVideos(){const t=(0,o.xpathNode)("//video");t&&(t.scrollIntoView(this.scrollOpts),await(0,o.sleep)(5*o.waitUnit));let e=(0,o.xpathNode)(this.firstVideoThumbnail)||(0,o.xpathNode)(this.firstVideoSimple);if(e)for(;e;){e.scrollIntoView(this.scrollOpts);let t=window.location.href;e.click(),await(0,o.waitUntil)((()=>window.location.href!==t),2*o.waitUnit),yield this.getState("Viewing video: "+window.location.href,"videos"),await(0,o.sleep)(10*o.waitUnit),await Promise.race([(0,o.waitUntil)((()=>{for(const t of(0,o.xpathNodes)("//video"))if(t.readyState>=3)return!0;return!1}),2*o.waitUnit),(0,o.sleep)(2e4)]),await(0,o.sleep)(10*o.waitUnit);const i=(0,o.xpathNode)(this.closeButtonQuery);if(!i)break;t=window.location.href,i.click(),await(0,o.waitUntil)((()=>window.location.href!==t),2*o.waitUnit),e=(0,o.xpathNode)(this.nextVideo,e)}}}},988:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var s=i(274),o=i(952),a=i(537),n=i(663),r=i(998);const l=[o.InstagramPostsBehavior,n.TwitterTimelineBehavior,s.FacebookTimelineBehavior,a.TelegramBehavior,r.TikTokVideoBehavior,r.TikTokProfileBehavior]},952:(t,e,i)=>{"use strict";i.r(e),i.d(e,{InstagramPostsBehavior:()=>a});var s=i(968),o=i(669);class a extends s.Behavior{static isMatch(){return window.location.href.match(/https:\/\/(www\.)?instagram\.com\/\w[\w.-]+/)}static get name(){return"Instagram"}constructor(){super(),this.state={},this.rootPath="//article/div/div",this.childMatchSelect="string(.//a[starts-with(@href, '/')]/@href)",this.childMatch="child::div[.//a[@href='$1']]",this.firstPostInRow="div[1]/a",this.postCloseButton="/html/body/div[last()]/div[1]/button[.//*[@aria-label]]",this.nextPost="//button[.//*[local-name() = 'svg'] and .//div/span[contains(@style, 'rotate(90deg)')]]",this.postLoading="//*[@aria-label='Loading...']",this.subpostNextOnlyChevron="//article[@role='presentation']//div[@role='presentation']/following-sibling::button",this.subpostPrevNextChevron=this.subpostNextOnlyChevron+"[2]",this.commentRoot="//article[@role='presentation']/div[1]/div[2]//ul",this.viewReplies="//li//button[span[not(count(*)) and text()!='$1']]",this.loadMore="//button[span[@aria-label]]",this.maxCommentsTime=1e4,this.postOnlyWindow=null,this.state={posts:0,slides:0,rows:0,comments:0}}cleanup(){this.postOnlyWindow&&(this.postOnlyWindow.close(),this.postOnlyWindow=null)}async waitForNext(t){return t?(await(0,o.sleep)(o.waitUnit),t.nextElementSibling?t.nextElementSibling:null):null}async*iterRow(){let t=(0,o.xpathNode)(this.rootPath);if(!t)return;let e=t.firstElementChild;if(e)for(;e;){await(0,o.sleep)(o.waitUnit);const t=new o.RestoreState(this.childMatchSelect,e);t.matchValue&&(yield e,e=await t.restore(this.rootPath,this.childMatch)),e=await this.waitForNext(e)}}async*viewStandalonePost(t){let e=(0,o.xpathNode)(this.rootPath);if(!e||!e.firstElementChild)return;const i=(0,o.xpathString)(this.childMatchSelect,e.firstElementChild);yield this.getState("Loading single post view for first post: "+i),window.history.replaceState({},"",i),window.dispatchEvent(new PopStateEvent("popstate",{state:{}}));let s=null,a=null;await(0,o.sleep)(5*o.waitUnit),await(0,o.waitUntil)((()=>(s=(0,o.xpathNode)(this.rootPath))!==e&&s),5*o.waitUnit),await(0,o.sleep)(5*o.waitUnit),window.history.replaceState({},"",t),window.dispatchEvent(new PopStateEvent("popstate",{state:{}})),await(0,o.waitUntil)((()=>(a=(0,o.xpathNode)(this.rootPath))!==s&&a),5*o.waitUnit)}async*iterSubposts(){let t=(0,o.xpathNode)(this.subpostNextOnlyChevron),e=1;for(;t;)t.click(),await(0,o.sleep)(5*o.waitUnit),yield this.getState(`Loading Slide ${++e} for ${window.location.href}`,"slides"),t=(0,o.xpathNode)(this.subpostPrevNextChevron);await(0,o.sleep)(5*o.waitUnit)}async iterComments(){const t=(0,o.xpathNode)(this.commentRoot);if(!t)return;let e=t.firstElementChild,i=!1,s="";for(;e;){e.scrollIntoView(this.scrollOpts),i=!0;let t=(0,o.xpathNode)(this.viewReplies.replace("$1",s),e);for(;t;){const i=t.textContent;t.click(),this.state.comments++,await(0,o.sleep)(2.5*o.waitUnit),await(0,o.waitUntil)((()=>i!==t.textContent),o.waitUnit),s=t.textContent,t=(0,o.xpathNode)(this.viewReplies.replace("$1",s),e)}if(e.nextElementSibling&&"LI"===e.nextElementSibling.tagName&&!e.nextElementSibling.nextElementSibling){let t=(0,o.xpathNode)(this.loadMore,e.nextElementSibling);t&&(t.click(),this.state.comments++,await(0,o.sleep)(5*o.waitUnit))}e=e.nextElementSibling,await(0,o.sleep)(2.5*o.waitUnit)}return i}async*iterPosts(t){let e=0;for(;t&&++e<=3;)for(t.click(),await(0,o.sleep)(10*o.waitUnit),yield this.getState("Loading Post: "+window.location.href,"posts"),await fetch(window.location.href),yield*this.iterSubposts(),yield this.getState("Loaded Comments","comments"),await Promise.race([this.iterComments(),(0,o.sleep)(this.maxCommentsTime)]),t=(0,o.xpathNode)(this.nextPost);!t&&(0,o.xpathNode)(this.postLoading);)await(0,o.sleep)(2.5*o.waitUnit);await(0,o.sleep)(5*o.waitUnit)}async*[Symbol.asyncIterator](){const t=window.location.href;yield*this.viewStandalonePost(t);for await(const t of this.iterRow()){t.scrollIntoView(this.scrollOpts),await(0,o.sleep)(2.5*o.waitUnit),yield this.getState("Loading Row","rows");const e=(0,o.xpathNode)(this.firstPostInRow,t);yield*this.iterPosts(e);const i=(0,o.xpathNode)(this.postCloseButton);i&&i.click(),await(0,o.sleep)(5*o.waitUnit)}}}},537:(t,e,i)=>{"use strict";i.r(e),i.d(e,{TelegramBehavior:()=>a});var s=i(968),o=i(669);class a extends s.Behavior{static name(){return"Telegram"}static isMatch(){return window.location.href.match(/https:\/\/t.me\/s\/\w[\w]+/)}constructor(){super(),this.telegramContainer="//main//section[@class='tgme_channel_history js-message_history']",this.postId="string(./div[@data-post]/@data-post)",this.linkExternal="string(.//a[@class='tgme_widget_message_link_preview' and @href]/@href)",this.state={messages:0}}async waitForPrev(t){return t?(await(0,o.sleep)(5*o.waitUnit),t.previousElementSibling?t.previousElementSibling:null):null}async*[Symbol.asyncIterator](){let t=(0,o.xpathNode)(this.telegramContainer);if(!t)return;let e=t.lastElementChild;for(;e;){e.scrollIntoView(this.scrollOpts);const t=(0,o.xpathString)(this.postId,e)||"unknown",i=(0,o.xpathString)(this.linkExternal,e);if(i&&i.endsWith(".jpg")||i.endsWith(".png")){yield this.getState("Loading External Image: "+i);const t=new Image;t.src=i,document.body.appendChild(t),await(0,o.sleep)(2.5*o.waitUnit),document.body.removeChild(t)}yield this.getState("Loading Message: "+t,"messages"),e=await this.waitForPrev(e)}}}},998:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BREADTH_ALL:()=>u,TikTokVideoBehavior:()=>w,TikTokProfileBehavior:()=>p});var s=i(968),o=i(669);const a="//div[contains(@class, 'CommentListContainer')]",n="div[contains(@class, 'CommentItemContainer')]",r=".//p[contains(@class, 'ReplyActionText')]",l=".//p[starts-with(@data-e2e, 'view-more') and string-length(text()) > 0]",h="//div[starts-with(@data-e2e, 'user-post-item-list')]",c="div[contains(@class, 'DivItemContainerV2')]",d="button[contains(@class, 'StyledCloseIconContainer')]",u=Symbol("BREADTH_ALL");class w extends s.Behavior{static get name(){return"TikTokVideo"}static isMatch(){return window.location.href.match(/https:\/\/(www\.)?tiktok\.com\/@.+\/video\/\d+\/?.*/)}constructor({breadth:t=u},e={}){super(),this.setOpts({breadth:t}),this.state=e}breadthComplete(t){const e=this.getOpt("breadth");return e!==u&&e<=t}async*crawlThread(t,e=null,i=0){const s=await(0,o.waitUntilNode)(l,t,e);s&&!this.breadthComplete(i)&&(await(0,o.scrollAndClick)(s,500),yield this.getState("View more replies","comments"),yield*this.crawlThread(t,s,i+1))}async*expandThread(t){const e=(0,o.xpathNode)(r,t);e&&(await(0,o.scrollAndClick)(e,500),yield this.getState("View comment","comments"),yield*this.crawlThread(t,null,1))}async*[Symbol.asyncIterator](){const t=(0,o.xpathNode)(a),e=(0,o.iterChildMatches)(n,t);for await(const t of e)t.scrollIntoView(this.scrollOpts),yield this.getState("View comment","comments"),this.breadthComplete(0)||(yield*this.expandThread(t));yield this.getState("TikTok Video Behavior Complete")}}class p extends s.Behavior{static get name(){return"TikTokVideo"}static isMatch(){return window.location.href.match(/https:\/\/(www\.)?tiktok\.com\/@.+\/?.*/)}constructor({breadth:t=u}){super(),this.setOpts({breadth:t}),this.state={videos:0,comments:0}}async*openVideo(t){const e=(0,o.xpathNode)(".//a",t);if(!e)return;const i=new o.HistoryState((()=>e.click()));if(await(0,o.sleep)(500),i.changed){const t=this.getOpt("breadth"),e=new w({breadth:t},this.state);yield*e,await(0,o.sleep)(500),await i.goBack(d)}}async*[Symbol.asyncIterator](){const t=(0,o.xpathNode)(h),e=(0,o.iterChildMatches)(c,t);for await(const t of e)t.scrollIntoView(this.scrollOpts),yield this.getState("View video","videos"),yield*this.openVideo(t),await(0,o.sleep)(500);yield this.getState("TikTok Profile Behavior Complete")}}},663:(t,e,i)=>{"use strict";i.r(e),i.d(e,{TwitterTimelineBehavior:()=>a});var s=i(968),o=i(669);class a extends s.Behavior{static isMatch(){return window.location.href.match(/https:\/\/(www\.)?twitter\.com\//)}static get name(){return"Twitter"}constructor({maxDepth:t=0}){super(),this.setOpts({maxDepth:t}),this.rootPath="//h1[@role='heading' and @aria-level='1']/following-sibling::div[@aria-label]/*[1]",this.anchorQuery=".//article",this.childMatchSelect="string(.//article//a[starts-with(@href, '/') and @aria-label]/@href)",this.childMatch="child::div[.//a[@href='$1']]",this.expandQuery=".//div[@role='button' and not(@aria-haspopup) and not(@data-testid)]",this.quoteQuery=".//div[@role='blockquote' and @aria-haspopup='false']",this.imageQuery=".//a[@role='link' and starts-with(@href, '/') and contains(@href, '/photo/')]",this.imageFirstNextQuery="//div[@aria-roledescription='carousel']/div[2]/div[1]//div[@role='button']",this.imageNextQuery="//div[@aria-roledescription='carousel']/div[2]/div[2]//div[@role='button']",this.imageCloseQuery="//div[@role='presentation']/div[@role='button' and @aria-label]",this.backButtonQuery="//div[@data-testid='titleContainer']//div[@role='button']",this.viewSensitiveQuery=".//a[@href='/settings/content_you_see']/parent::div/parent::div/parent::div//div[@role='button']",this.progressQuery=".//*[@role='progressbar']",this.promoted=".//div[data-testid='placementTracking']",this.seenTweets=new Set,this.seenMediaTweets=new Set,this.state={tweets:0,images:0,videos:0}}async waitForNext(t){if(!t)return null;if(await(0,o.sleep)(2*o.waitUnit),!t.nextElementSibling)return null;for(;this.showingProgressBar(t.nextElementSibling);)await(0,o.sleep)(o.waitUnit);return t.nextElementSibling}showingProgressBar(t){const e=(0,o.xpathNode)(this.progressQuery,t);return!!e&&e.clientHeight>10}async expandMore(t){const e=(0,o.xpathNode)(this.expandQuery,t);if(!e)return t;const i=t.previousElementSibling;for(e.click(),await(0,o.sleep)(o.waitUnit);this.showingProgressBar(i.nextElementSibling);)await(0,o.sleep)(o.waitUnit);return t=i.nextElementSibling}async*infScroll(){let t=(0,o.xpathNode)(this.rootPath);if(!t)return;let e=t.firstElementChild;if(e)for(;e;){let t=(0,o.xpathNode)(this.anchorQuery,e);if(!t&&this.expandQuery&&(e=await this.expandMore(e,this.expandQuery,this.progressQuery),t=(0,o.xpathNode)(this.anchorQuery,e)),e&&e.innerText&&e.scrollIntoView(this.scrollOpts),e&&t){await(0,o.sleep)(o.waitUnit);const i=new o.RestoreState(this.childMatchSelect,e);yield t,i.matchValue&&(e=await i.restore(this.rootPath,this.childMatch))}e=await this.waitForNext(e,this.progressQuery)}}async*mediaPlaying(t){const e=(0,o.xpathNode)("(.//video | .//audio)",t);if(!e||e.paused)return;let i,s=null;try{s=new URL((0,o.xpathString)(this.childMatchSelect,t.parentElement),window.location.origin).href}catch(t){console.warn(t)}if(e.src.startsWith("https://")&&e.src.indexOf(".mp4")>0)return void(yield this.getState(`Loading video for ${s||"unknown"}`,"videos"));if(s){if(this.seenMediaTweets.has(s))return;i=`Waiting for media playback for ${s} to finish`,this.seenMediaTweets.add(s)}else i="Loading video";yield this.getState(i,"videos");const a=new Promise((t=>{e.addEventListener("ended",(()=>t())),e.addEventListener("abort",(()=>t())),e.addEventListener("error",(()=>t())),e.addEventListener("pause",(()=>t()))}));await Promise.race([a,(0,o.sleep)(6e4)])}async*iterTimeline(t=0){if(!this.seenTweets.has(window.location.href)){yield this.getState("Capturing thread: "+window.location.href,"threads");for await(const e of this.infScroll()){if((0,o.xpathNode)(this.promoted,e))continue;await(0,o.sleep)(2.5*o.waitUnit);const i=(0,o.xpathNode)(this.viewSensitiveQuery,e);i&&(i.click(),await(0,o.sleep)(2.5*o.waitUnit)),yield*this.clickImages(e,t);const s=(0,o.xpathNode)(this.quoteQuery,e);s&&(yield*this.clickTweet(s,1e3)),yield*this.mediaPlaying(e),yield*this.clickTweet(e,t),await(0,o.sleep)(5*o.waitUnit)}}}async*clickImages(t){const e=(0,o.xpathNode)(this.imageQuery,t);if(e){const t=new o.HistoryState((()=>e.click()));yield this.getState("Loading Image: "+window.location.href,"images"),await(0,o.sleep)(5*o.waitUnit);let i=(0,o.xpathNode)(this.imageFirstNextQuery),s=window.location.href;for(;i;){if(i.click(),await(0,o.sleep)(2*o.waitUnit),window.location.href===s){await(0,o.sleep)(5*o.waitUnit);break}s=window.location.href,yield this.getState("Loading Image: "+window.location.href,"images"),await(0,o.sleep)(5*o.waitUnit),i=(0,o.xpathNode)(this.imageNextQuery)}await t.goBack(this.imageCloseQuery)}}async*clickTweet(t,e){const i=new o.HistoryState((()=>t.click()));if(await(0,o.sleep)(o.waitUnit),i.changed){yield this.getState("Capturing Tweet: "+window.location.href,"tweets");const t=this.getOpt("maxDepth");e<t&&!this.seenTweets.has(window.location.href)&&(yield*this.iterTimeline(e+1,t)),this.seenTweets.add(window.location.href),await(0,o.sleep)(2*o.waitUnit),await i.goBack(this.backButtonQuery),await(0,o.sleep)(o.waitUnit)}}async*[Symbol.asyncIterator](){yield*this.iterTimeline(0)}}},75:(t,e,i)=>{var s={".":138,"./":138,"./autofetcher":278,"./autofetcher.js":278,"./autoplay":940,"./autoplay.js":940,"./autoscroll":884,"./autoscroll.js":884,"./index":138,"./index.js":138,"./lib/behavior":968,"./lib/behavior.js":968,"./lib/utils":669,"./lib/utils.js":669,"./site":988,"./site/":988,"./site/facebook":274,"./site/facebook.js":274,"./site/index":988,"./site/index.js":988,"./site/instagram":952,"./site/instagram.js":952,"./site/telegram":537,"./site/telegram.js":537,"./site/tiktok":998,"./site/tiktok.js":998,"./site/twitter":663,"./site/twitter.js":663};function o(t){return Promise.resolve().then((()=>{if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i(s[t])}))}o.keys=()=>Object.keys(s),o.id=75,t.exports=o}},e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={exports:{}};return t[s](o,o.exports,i),o.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.e=()=>Promise.resolve(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};i(138)})();